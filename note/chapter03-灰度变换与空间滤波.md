## chapter03-灰度变换与空间滤波

## 3.1 背景知识

### 3.1.1 灰度变换和空间滤波基础

Q：空间域的定义？

A：空间域就是简单的包含图像像素的平面。

Q：如何比较空间域和频率域？

A：域（第4章的主题）频率域相反，空间域技术直接在图像像素上操作，而频率域是在图像的傅里叶变换域上进行操作。

Q：如何评价空间域技术？

A：计算更高效，所需处理资源更少。

Q：空间域处理的数学模型是什么？

A：见式（3.1-1）。

Q：灰度（也称灰度级或映射）变换函数的定义？

A：1\*1最小邻域的变换，即输出点仅与相应位置输入点相关的变换就叫做灰度变换函数，具体式子如（3.1-2）。

Q：**对比度拉伸**的概念？

A：确定阈值k，大于k则变亮，小于k则变暗，即亮的越亮，暗的越暗，这就叫对比度拉伸。

Q：灰度变换函数有什么用？

A：

1）本章使用灰度变换函数可以进行图像增强；

2）第10章使用灰度变换函数进行图像分割。

### 3.1.2 关于本章中的例子

本章中的例子是关于图像增强应用，但是灰度变换和空间滤波不仅仅用于图像增强中。

## 3.2 一些基本的灰度变换函数

Q：灰度变换函数一般是如何具体实现的？

A：灰度变换函数一般使用查找表实现。

Q：图像增强是如何进行分类的？

A：线性函数，对数函数，幂律函数和恒等函数。

### 3.2.1 图像反转

Q:图像反转的数学表达式是什么？

A：见式（3.2-1）。

Q：图像反转的应用场景是什么？

A：特别是当黑色面积在尺寸上占主导地位时，要突出白色或灰色细节。具体见图3.4乳房X射线照片。

### 3.2.4 分段线性变换函数

#### 对比度拉伸

Q：对比度拉伸的定义？

A：对比度拉伸是**扩展图像灰度级动态范围**的处理。 P.S 对比度拉伸函数一般是单调递增的。

#### 灰度级分层

Q：灰度级分层的定义？

A：突出图像中特定灰度范围的亮度叫灰度级分层。P.S 见图3.11。



**Q**：**图像增强**包括哪些内容？

**A**：空域平滑、图像锐化、彩色增强技术、频域增强。

Q：空域平滑的目的？

**Q**：图像锐化的目的？

**A**：使得图像的边缘和边界更加清晰，有利于图像后处理。

**Q**：彩色增强技术的目的？

**A**：人们对灰色辨别能力较低，对彩色辨别较高。

**Q**：图像增强的**目的**有哪些？

**A**：

1）改善图像视觉效果，提高图像清晰度：平滑、降噪——图像清晰；

2）利于后期图像处理：锐化——突出便越轮廓，便于后期特征分析。

**Q**：图像增强方法的分类？

**A**：主要分为空域法和频域法，具体分类见视频2‘。

**Q**：图像噪声的定义？

**A**：在图像摄取或传输过程中所受到的随机干扰信号。

**Q**：图像噪声有哪些特性？

**A**：

1）**随机性**：

​		-白噪声，色噪声；

​		-高斯噪声，椒盐噪声；

2）**孤立性**；

3）加性噪声、乘性噪声、量化噪声。

## 3.3 直方图处理

**Q**：直方图的**地位**？

**A**：最简单、最有用的工具之一。“从对图像的分析与观察，直到形成一个有效的处理方法，都离不开直方图”。

**Q**：直方图的**定义**？

**A**：表示数字图像中每一灰度级像素出现的频次（该灰度级的像素数目）。直方图的**概率定义**见书本P72或视频2'，视频中的例子讲的很不错。  

**Q**：直方图的性质？

**A**：

1）**无空间信息**；

2）直方图与图像**一对多**关系；

3）可叠加性（全图与子图像）。

**图像直方图直观认识**：

1）**中间灰度**级像素多，动态范围小，图像**对比度低**；

2）**高灰度**的像素占了绝大部分，图像**偏亮**；

3）过低、过高灰度级的像素占了绝大部分（类似于2值图像），**对比度过大**；

**重要结论**：

1）直方图反映了图像的清晰程度。直方图**均匀分布**时，图像**最清晰**；

2）**判断**一幅图像是否清晰，查看是否合理的利用了全部被允许的灰度级；

3）一幅图像**应该**尽可能利用**全部**可能的灰度级。

### 3.2.3 幂律(伽马)变换

**Q**:为什么要研究幂律变换？

**A**:

1)有些设备的相应为幂律相应，可以使用幂律变换进行校正;

2)使用幂律变换进行对比度增强。

**Q**：幂律变化的基本形式是什么？

**A**:见书本公式(3.2-3)。

**结论**：幂函数的指数在(0,1)范围内，会使得图像整体变亮;幂函数的指数大于1时，会使得图像整体变暗。

## 3.5 平滑空间滤波器

**Q**：平滑滤波器的**作用**是什么？

**A**：平滑滤波器用于**模糊处理**和**降低噪声**。

**Q**：好好的一张图片，干嘛要进行模糊处理？（换成专业问法就是：图像模糊处理的**目的**是什么？）

**A**：模糊处理经常用于**预处理**任务中，例如在（大）目标提取之前去除图像中的一些琐碎细节，以及连接直线或曲线的缝隙。

### 3.5.2 统计排序(非线性)滤波器

**小结**:本小节主要介绍了统计排序(非线性)滤波器中最典型的中值滤波器概念.

Q:何为中值滤波器?

A:以3*3的中值滤波器为例,输出点为相应输入位置3 * 3l邻域的中位数.

Q:如何评价中值滤波器?

A:中值滤波器的主要功能是使拥有不同灰度的点看起来更接近它的相邻居点.实验表明,中值滤波去椒盐噪声的效果要比均值滤波好.

## 3.6 锐化空间滤波器

**小结**：图像锐化的**目的**是获取我们想要的图像边缘信息，基于的是一阶和二阶微分的**数学原理**，有一些**常用的算子**，如拉普拉斯、Sobel、Prewitt、高频滤波、Canny算子等。**没有万能算子**，一个算子不能解决所有图像锐化的问题，目前我知道的通过眼睛看是**评价**锐化效果最直观的方法。

**Q**：本节主要讲了啥？

**A**：本节将讨论**由数学微分来定义和实现**锐化算子的各种方法。

**Q**：图像锐化和图像增强的关系？

**A**：图像锐化是属于图像增强的范畴。

**Q**：锐化处理的**目的**是什么？

**A**：锐化处理的主要目的是**突出灰度的过度**部分。增强图像细节边缘和轮廓，灰度反差增强，便于后期对目标的识别和处理。

**Q**：锐化的**方法**有哪些？

**A**：微分、高通滤波

**Q**：锐化处理可能出现的**副作用**是什么？

**A**：锐化处理在增强图像边缘的同时增强了图像的噪声。

**Q**：图像锐化的**用途**有哪些？

**A**：图像锐化的用途多种多样，应用范围从电子印刷和医学成像到工业检测和军事系统的制导等。

**Q**：锐化和模糊（平滑）的关系？

**A**：锐化和模糊（平滑）是相对的概念，锐化在数学上基于积分，是通过增强高频分量来减少图像中的模糊，模糊在数学上基于微分，是通过减少高频分量来使图像更加平滑。

**说明**：视频4‘用一幅图（图片很典型：有光斑、孤立点、边缘）说明了灰度变化特性，并且绘制出了"图像细节的灰度分布特性"图。

### 3.6.1 基础

**Q**：灰度变化的**典型分类**？

**A**：阶跃形、细线形、斜坡渐变形。

**Q**：为什么要研究图像的一阶微分和二阶微分？

**A**：根据灰度变化的类型及其一阶微分或二阶微分是否为最大/小、是否为过0点来所搜索边缘点，就可以对找到的这些边缘点进行搜索和处理。

Q：为什么说二阶微分在增强细节方面要比一阶微分好得多，是一个适合锐化图像的理想特性？

A：数字图像处理中的边缘在灰度上通常类似于斜坡过渡，因此会导致图像的一阶微分产生较粗的边缘，因而沿斜坡的微分非零。另一方面，二阶微分产生由零分开的一个像素宽的双边缘。

### 3.6.2 使用二阶微分锐化图像——拉普拉斯算子

本小节相关知识：2.6.3 算术操作、第10章。

**Q**：如何**理解**拉普拉斯算子？

**A**：

1）拉普拉斯算子属于各项**同性滤波器**（所谓各向同性滤波器就是这种滤波器的响应与滤波器作用的图像的突变方向无关）的范畴；

2）**最简单的**（书中给出了证明其最简单的论文，不用管了，因为这不是重点）各向同性微分算子就是拉普拉斯算子；

3）拉普拉斯算子是**二次微分算子**，与梯度算子一样，具有旋转不变性，从而满足不同走向的图像边缘的锐化要求；

4）拉普拉斯算子的基本形式是等于中心点与其领域值之差。

**Q**：如何理解使用拉普拉斯算子进行图像增强的？

**A**：可以通过理解拉普拉斯增强图像基本方法的**数学表达式**，具体表达式见书本P100的公式（3.6-7）。

**Q**：如何**评价**拉普拉斯算子？

**A**：拉普拉斯算子获得的边界比较细，包括较多的细节信息，但边界不太清晰。

### 3.6.4 使用一阶微分锐化（非线性）图像——梯度

**Q**：图像处理中的一阶微分是如何实现的？

**A**：图像处理中的一阶微分是用梯度幅值来实现的。

**Q**：梯度的数学定义？

**A**：梯度是二维列向量，具体定义见书本P101。

**说明**：图像中常用的是梯度的模，以后不作特殊说明，提到梯度均指梯度的模。

**说明**（以下两点在视频22'有讲解）：

1）对离散图像，微分可以用差分来近似表示；

2）为便于编程和提高运算速度，在某些场合可以用**绝对值**表示，即沿水平轴和垂直轴两个方向的**差分和**。

**Q**：求出了梯度之后，如何确定锐化输出呢？

**A**：

1）直接以梯度代替：简单。但是在图像均匀区域，梯度很小，甚至为零，结果图像较暗（用图像直方图均衡化来解决这个问题0；

2）输出门限判断：不会破坏图像背景，又可以增强图像；

3）为边缘规定一个特定的灰度级；

4）为背景规定特定的灰度级；

5）二值化图像。

**说明**：视频31'讲了一个例子。

**Q**：罗伯特梯度算子的原理和评价？

**A**：原理：对象方向的微分和。特点：算法简单、无方向性。评价：该算子为2*2模板，提取的边缘信息较弱（一般即使很陡峭的边缘也有几个像素）。

### 高通滤波

**Q**：高通滤波为什么用图像锐化的功能？

**A**：图像边缘与高频分量相对应，高通滤波器抑制低频分量，从而达到图像锐化的目的。

**Q**：高通滤波的模板有哪些？

**A**：高通滤波的模板有很多，具体见视频1'，视频也也讲了各个高斯滤波模板的效果。

**Q**：高通滤波和拉普拉斯滤波的关系？

**A**：在拉普拉斯算子的基础上加上原图像就是高通滤波，可见卷积模板神奇有效。具体见视频4'。

### 模板匹配法

**Q**：模板匹配法的**特点**？

**A**：考虑到**方向特性**，而之前介绍的方法（如梯度法、拉普拉斯法、罗伯特法、高通滤波法等）没有考虑到方向特性。

**Q**：模板匹配法的**基本原理**？

**A**：将**8个方向**、**大小为3×3的模板**，顺序作用于**同一图像窗口**，并对结果进行**排序**，将**最大的**结果值作为窗口中心像素锐化输出。

**Sobel算子**

**Q**：Sobel算子的定义？

**A**：见视频13'。

**Q**：Sobel算子的特点是什么？

**A**：锐化的边缘信息较强。Sobel算子获得的边缘比较粗，比较清晰。

**Prewitt算子**

**Q**：Prewitt算子的模板有哪些？

**A**：见视频18'。

**Q**：Prewitt算子的特点？

**A**：有一定的抗干扰性，图像效果比较干净。算子本身再加上阈值处理，会产生边缘断裂。

**Q**：Prewitt算子各个模板的效果？

**A**：不同方向检测的效果不一样，具体见视频20'。

**Q**：如何评价Prewitt算子？

**A**：模板匹配法除了能增强图像边缘外，还具有平滑噪声的优点，总体上优于梯度和拉普拉斯算子。

**高斯拉普拉斯（Laplacian of Gaussian，简称LoG）**

原理，效果

先滤波后边缘检测。算法效果不错的。

**Canny算子**

效果好，算法复杂。

Q：如何评价图像锐化和边缘检测？

A：图像锐化、边缘检测研究比较专业，是研究热点、非常重要、非常困难，如何获取我们所需的边缘信息，从而方便我们对图像进一步的分析与处理。

### 小结

1)  突变型细节，通过一阶微分的极大值点，二阶微分的过0点可以检测出来。

2)  细线型细节，通过一阶微分的过0点，二阶微分的极小值点均可以检测出来。

3)  渐变型细节，一般情况下很难检测，但二阶微分的信息比一阶微分信息略多。



## 参考资料

1. [数字图像处理 任获荣 19](  https://www.bilibili.com/video/av61178093?p=19  )
2. [数字图像处理 任获荣 21](  https://www.bilibili.com/video/av61178093?p=21  )
3. 数字图像处理 第三版 冈萨雷斯